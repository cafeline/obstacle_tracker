## ロボット障害物検出・追跡パッケージ開発要件書

### 1. 開発環境要件

* **ベースパッケージ**: `obstacle_tracker` (C++で記述されたROS 2パッケージ) を編集します。
* **作業ディレクトリ**: `/home/ryo/tvvf_vo/ws/obstacle_tracker` 内のファイルを自由に編集してください。
* **ファイル操作**: `rm`等の削除系コマンドの使用は禁止します。削除系以外のコマンドは自由に利用可能です。
* **実行環境**: ホスト側 (`/home/ryo/tvvf_vo/ws/obstacle_tracker`) で編集を行い、ビルドと実行はDockerコンテナ内（コンテナID: `b9475c0c3d2e`）で行ってください。

---

### 2. 技術的要件

#### 2.1. レーザースキャンデータ処理

* **入力トピック**:
    * ROS 2トピック `/scan` を購読し、レーザースキャンデータを受け取ります。
    * メッセージ型は `sensor_msgs/msg/LaserScan` とします。
* **ボクセル化**:
    * 入力された `sensor_msgs/msg/LaserScan` データから点群を生成し、ボクセルグリッドに変換します。
    * **ボクセルサイズ**はパラメータとして設定可能にしてください。（例: `0.1 [m]`）
    * 点群の密度を均一化し、処理負荷を軽減する目的です。
* **クラスタリング**:
    * ボクセル化された点群に対して、**PCLなどの外部ライブラリを使用せずに**、独自のクラスタリングアルゴリズムを実装してください。
    * **クラスタリングの最大距離**（例: `0.5 [m]`）はパラメータとして設定可能にしてください。
    * **クラスタに含まれる最小点群数**: クラスタ内の点群数が `2` 点以下の場合、そのクラスタは破棄してください。

#### 2.2. ロボットの範囲と処理対象

* **ロボットの処理範囲**:
    * ロボットを中心とした球状の範囲 `10.0 [m]` (半径) 内の点群のみを処理対象としてください。
    * この範囲は `double` 型のROS 2パラメータとして設定可能にしてください。（例: `robot_processing_range`, デフォルト値: `10.0 [m]`）
* **処理速度の最適化**:
    * **並列処理や外部ライブラリの使用は禁止**します。
    * アルゴリズムの選択や実装方法の工夫（例: 効率的なデータ構造の利用、不要な計算の省略、ループ最適化など）によって処理速度を向上させてください。

#### 2.3. クラスタの分類と追跡

* **クラスタの移動速度計算**:
    * 各クラスタの重心移動を追跡し、その速度を計算してください。
    * クラスタ追跡には、**シンプルな移動平均**アルゴリズムを適用してください。
* **動的・静的クラスタの判別**:
    * 計算されたクラスタの移動速度が、しきい値 `0.5 [m/s]` を超える場合は「動的なクラスタ」と判別してください。
    * この速度しきい値は `double` 型のROS 2パラメータとして設定可能にしてください。（例: `dynamic_cluster_speed_threshold`, デフォルト値: `0.5 [m/s]`）
    * 上記しきい値以下のクラスタは「静的なクラスタ」と判別してください。

#### 2.4. 出力と可視化

* **トピック配信**:
    * **動的クラスタ**: ROS 2トピック `/dynamic_obstacles` として配信してください。
    * **静的クラスタ**: ROS 2トピック `/static_obstacles` として配信してください。
    * 各トピックのメッセージ型は `visualization_msgs/msg/MarkerArray` とします。

---

### 3. その他

* ノード名、トピック名、パラメータ名、ログメッセージ等は、ROS 2の命名規則とC++のコーディング規約に従ってください。
* 適切なエラーハンドリングを実装し、データが空の場合や異常値が含まれる場合にも安定して動作するようにしてください。
* 適切にモジュール化とファイル分けを行ってください。